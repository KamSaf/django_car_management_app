{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block javascripts %}
    {{ block.super }}
        <script src="{% static '/javascript/home.js' %}" type="text/javascript"></script>
        <script src="{% static '/javascript/clock.js' %}" type="text/javascript"></script>
{% endblock %}


{% block body %}
    <div style="margin-top: 25px;" class="container-fluid">
        <div style="margin-top: 25px;" class="shadow bg-body rounded card">
            <div class="card-body">
                <h5 class="card-title">
                    <b>CAR NAME</b>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#cars_list_modal"><i class="bi bi-chevron-down"></i></button>
                    <button class="btn btn-sm btn-outline-info float-end" data-bs-toggle="modal" data-bs-target="#car_details_modal">Car details</button>
                </h5>
                <hr>
                <h5 style="display: inline;">
                    <div id="date"></div>
                    <div style="margin-top: 5px;" id="clock"></div>
                </h5>
            </div>
        </div>
    </div>

    <div style="margin-top: 25px;" class="container-fluid">
    <div class="row">
        <div class="col">
            <div style="margin-top: 25px;" class="shadow bg-body rounded card">
                <div class="card-body">
                    <h5 class="card-title">
                        Exploatation History
                        <a class="btn btn-sm btn-outline-info float-end">See full history</a>
                    </h5>
                    <hr>
                    <h1>placeholder</h1>
                </div>
            </div>
        </div>
        <div class="col">
            <div style="margin-top: 25px;" class="shadow bg-body rounded card">
                <div class="card-body">
                        <ul class="nav nav-tabs" id="monthTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="last-month-tab" data-bs-toggle="tab" data-bs-target="#last-month" type="button" role="tab" aria-controls="last-month" aria-selected="false">Last Month</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="this-month-tab" data-bs-toggle="tab" data-bs-target="#this-month" type="button" role="tab" aria-controls="this-month" aria-selected="true">This Month</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="monthTabContent">
                        <div class="tab-pane fade" id="last-month" role="tabpanel" aria-labelledby="last-month-tab">
                            <div style="margin-left: 25px; margin-top: 25px;" class="container">
                                <div class="row">
                                    <div class="col">
                                        <h6>Expenses:</h6>
                                        <h4 class="text-danger fw-bold">37,21 zł</h4>
                                        <p class="text-muted fw-lighter">4,23 zł per day</p>
                                    </div>
                                    <div class="col">
                                        <h6>Fuel economy:</h6>
                                        <h4 class="text-warning fw-bold">8,9l / 100 km</h4>
                                        <p class="text-muted fw-lighter">1,20 zł per kilometer</p>
                                    </div>
                                    <hr>
                                <div class="row">
                                    <div class="col"><i class="bi bi-fuel-pump"></i> Fuel: <b>86%</b></div>
                                    <div class="col"><i class="bi bi-tools"></i> Service: <b>10%</b></div>
                                    <div class="col"><i class="bi bi-cart-plus"></i> Others: <b>4%</b></div>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade show active" id="this-month" role="tabpanel" aria-labelledby="this-month-tab">
                            <div style="margin-left: 25px; margin-top: 25px;" class="container">
                                <div class="row">
                                    <div class="col">
                                        <h6>Expenses:</h6>
                                        <h4 class="text-danger fw-bold">21,37 zł</h4>
                                        <p class="text-muted fw-lighter">6,90 zł per day</p>
                                    </div>
                                    <div class="col">
                                        <h6>Fuel economy:</h6>
                                        <h4 class="text-warning fw-bold">9,3l / 100 km</h4>
                                        <p class="text-muted fw-lighter">1,63 zł per kilometer</p>
                                    </div>
                                    <hr>
                                <div class="row">
                                    <div class="col"><i class="bi bi-fuel-pump"></i> Fuel: <b>70%</b></div>
                                    <div class="col"><i class="bi bi-tools"></i> Service: <b>15%</b></div>
                                    <div class="col"><i class="bi bi-cart-plus"></i> Others: <b>15%</b></div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col"></div>
        <div class="col">
            <div style="margin-top: 25px;" class="shadow bg-body rounded card">
                <div class="card-body">
                    <h5 class="card-title">
                        Favourite workshops:
                        <button class="btn btn-sm btn-outline-info float-end" data-bs-toggle="modal" data-bs-target="#workshops_list_modal">See all saved workshops</button>
                    </h5>
                    <hr>
                    <div class="overflow-auto" style="max-height: 175px;">
                        <ul class="list-group w-auto" style="list-style: none;">
                            {% for workshop in workshops %}
                                <button class="btn btn-light show-workshop-details" style="margin-bottom: 5px;" data-bs-toggle="modal" data-bs-target="#workshop_details_modal" data-url="{% url 'workshop_details_url' workshop_id=workshop.id %}">
                                    <li style="max-height: 50px;">
                                        <div class="row">
                                            <span class="col text-start">{{ workshop.name }}</span>
                                            <span class="col text-center">
                                                tel.
                                                {{ workshop.phone_number|slice:"0:3" }}
                                                {{ workshop.phone_number|slice:"3:6" }}
                                                {{ workshop.phone_number|slice:"6:9" }}
                                            </span>
                                            <span class="col text-end">{{ workshop.address }}, {{ workshop.city }}</span>
                                        </div>
                                    </li>
                                </button>
                            {% endfor %}                            
                        </ul>
                    </div>
                    <button style="margin-top: 15px;" class="btn btn-sm btn-outline-success new-workshop-main float-end" data-bs-toggle="modal" data-bs-target="#new_workshop_modal">Add new workshop <i class="bi bi-plus-circle"></i></button>
                </div>
            </div>
        </div>
    </div>

<!-- MODALS -->

    <!-- Cars list modal -->
    <div class="modal fade" id="cars_list_modal" tabindex="-1" role="dialog" aria-labelledby="cars_list_modal_label" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="cars_list_modal_label">Your cars</h5>
            </div>
            <div class="modal-body">
                cars list
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success add-new-car" data-bs-dismiss="modal" id="add_new_car_button">Add new car +</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Car details modal -->
    <div class="modal fade" id="car_details_modal" tabindex="-1" role="dialog" aria-labelledby="car_details_modal_label" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="car_details_modal_label">Your cars</h5>
            </div>
            <div class="modal-body">
                car details
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success edit-car-details" data-bs-dismiss="modal" id="edit_car_details_button">Edit</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Workshops list modal -->
    <div class="modal fade" id="workshops_list_modal" tabindex="-1" role="dialog" aria-labelledby="workshop_list_modal_label" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="workshop_list_modal_label">Your saved workshops</h5>
            </div>
            <div class="modal-body">
                {% include 'include/workshops/workshops_list.html' %}
            </div>
            <div class="modal-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-4">
                            <button type="button" class="btn btn-outline-dark float-start" data-bs-toggle="collapse" data-bs-target="#filter_options" aria-expanded="false" aria-controls="filter_options">Filter options</button>
                        </div>
                        <div class="col-8">
                            <span class="float-end">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-success new-workshop-embedded" data-bs-target="#new_workshop_modal" data-bs-toggle="modal" id="edit_car_details_button">Add new workshop +</button>    
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="collapse" id="filter_options">
                <div class="card card-body container">
                    <div class="row">
                        <div class="col-3 text-start">
                            <select class="form-select" id="workshop_filter_categories">
                                <option value="name">Name</option>
                                <option value="city">City</option>
                                <option value="address">Address</option>
                                <option value="profession">Profession</option>
                              </select>
                        </div>
                        <div class="col-3 text-start">
                            <input id="" style="margin-left: 5px;" class="form-control" type="text" placeholder="Enter phrase to filter by">
                        </div>
                        <div class="col-2 text-start">
                            <button class="btn btn-outline-dark">Apply filters</button>
                        </div>
                        <div class="col-4 text-end">
                            <button class="btn btn-outline-dark">Reset filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Workshop details modal -->
    <div class="modal fade" id="workshop_details_modal" tabindex="-1" role="dialog" aria-labelledby="workshop_details_modal_label" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div id="workshop_details_modal_content" class="modal-content"></div>
        </div>
    </div>

    <!-- New workshop modal -->
    <div class="modal fade" id="new_workshop_modal" tabindex="-1" role="dialog" aria-labelledby="new_workshop_modal_label" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="new_workshop_modal_label">New workshop</h5>
            </div>
            <form id="new_workshop_form" method="POST">
                <div class="modal-body">
                        <div id="new_workshop_submit_info" class="alert alert-danger" role="alert" style="display: none;"></div>
                        {% csrf_token %}
                        {{ new_workshop_form|crispy }}
                </div>
                <div class="modal-footer">
                    <button id="new_workshop_close_modal_button" type="button" class="btn btn-secondary close-new-workshop-modal" data-bs-target="#workshops_list_modal" data-bs-toggle="modal">Go back</button>
                    <button type="button" class="btn btn-success save-new-workshop" id="edit_car_details_button" data-url="{% url 'add_new_workshop_url' %}">Save</button>
                </div>
            </form>
        </div>
        </div>
    </div>
{% endblock %}